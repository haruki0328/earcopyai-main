AI Guitar Tab Creator 要件定義書
1. システムの概要
本システムは、音楽ファイルをアップロードすることで、AIが自動的にギターの音を聴き取り、ギタリストが読みやすい形式のTAB譜（テキスト形式）を生成するWebアプリケーションです。耳コピの補助や、楽譜のない楽曲の解析を目的としています。
2. システム構成
• フロントエンド・UI: Streamlit
• バックエンド: Python 3.8
• 使用AIモデル:
• 音源分離：Demucs（楽曲からギター音のみを抽出）
• 自動採譜：Omnizart（ギター音を音符データに変換）
• 主要ライブラリ: PrettyMIDI, NumPy, Pandas
3. 機能要件
■ 入力・設定機能
• 音声ファイルアップロード: MP3およびWAV形式のファイルに対応。
• カポタスト設定: 0〜7フレットの範囲でカポ位置を指定し、TAB譜の数字を自動補正。
• 移調（Transpose）設定: ±12半音の範囲でキーを調整し、変則チューニング等に対応。
■ 解析・処理機能
• 音源分離処理: 混合音源からギターパートのみを分離。
• 自動採譜処理: 分離された音源から音程・リズム情報を抽出。
• バカ正直（シンプル）ロジック: 人間工学的な制限を排し、AIが聞き取った音を最も効率的な弦の位置へ配置。
■ 表示・出力機能
• 音源再生プレイヤー: 元の曲と、AIが抽出したギター音を聴き比べることが可能。
• 自動折り返しTAB譜表示: 長い楽曲でも画面からはみ出さないよう、一定の長さで改行して表示。
• 上下反転表示: ユーザーの好みに合わせ、1弦を上にするか6弦を上にするかを切り替え可能。
• MIDIダウンロード: 解析結果のMIDIファイルを保存。
4. 非機能要件
• ユーザビリティ: コマンド操作を不要とし、ブラウザ上のクリック操作のみで完結。
• 処理の透明性: 解析に時間がかかるため、プログレスバーによる進捗表示を行う。
• 動作環境: Windows 10/11、Python 3.8、およびFFmpegがインストールされていること。


# 🎸 AI Guitar Tab Creator

MP3/WAV音源をアップロードするだけで、AIがギターパートを抽出し、自動でTAB譜（タブ譜）を生成するWebアプリケーションです。

![Python](https://img.shields.io/badge/Python-3.8-blue.svg)
![Streamlit](https://img.shields.io/badge/Framework-Streamlit-red.svg)
![AI Models](https://img.shields.io/badge/AI-Demucs%20%2B%20Omnizart-green.svg)

## 📖 目次
- [システムの目的（課題解決）](#-システムの目的課題解決)
- [ユニーク性・特徴](#-ユニーク性特徴)
- [インストール・起動手順](#-インストール起動手順)
- [技術スタック](#-技術スタック)

---

## 🎯 システムの目的（課題解決）

**「この曲を弾きたいけど、TAB譜がない」「耳コピをする時間やスキルがない」というギタリストの悩みを解決します。**

既存の自動採譜ソフトの多くはピアノ（MIDI）向けの出力がメインで、ギタリストが必要とする「6本弦のTAB譜形式」での出力には強くありませんでした。また、市販のスコアは高価であったり、そもそも販売されていない曲も多数存在します。

本システムは、**「手持ちの音源から、誰でも瞬時に、視認性の高いギターTAB譜を手に入れる」** ことを目的として開発されました。

---

## 🦄 ユニーク性・特徴

このアプリケーションは単なる「音階検出」だけでなく、ギタリストが実際に演奏することを想定した以下の独自機能を備えています。

### 1. 複合AIによる高精度な抽出
- **Demucs (音源分離AI):** 楽曲から「ギターの音だけ」をクリアに抜き出します。ドラムやボーカルに惑わされず、純粋なギターフレーズを解析対象とします。
- **Omnizart (採譜AI):** 抽出されたギター音源を高精度に解析し、MIDIデータへ変換します。

### 2. ギタリスト視点のTAB変換ロジック
AIが出力した音程データを、単に数字にするのではなく、人間が演奏しやすいポジションに配置する独自のアルゴリズムを実装しています。
- **ロック・ポップス特化:** 低音弦（太い弦）を優先的に使用するロジックを採用し、パワーコードやリフの雰囲気を再現します。
- **カポタスト対応:** カポ使用時のフレットズレを自動計算で補正可能です。

### 3. インタラクティブな調整機能 (Streamlit UI)
解析結果を見ながら、リアルタイムで以下の調整が可能です。
- **TAB反転機能:** 「1弦が上」か「6弦が上」か、プレイヤーの好みに合わせて表示を瞬時に切り替えられます。
- **表示整形:** 長いTAB譜を自動で折り返し、スマホやPC画面で見やすく整形して出力します。

インストール・起動手順
本アプリケーションは Windows かつ Python 3.8 環境での動作を想定しています。
また、音声処理のバックエンドとして FFmpeg が必須です。
0. 事前準備 (FFmpeg)
FFmpegがインストールされていない場合、エラーになります。
1. FFmpeg公式サイト からWindows版をダウンロード。
2. 解凍したフォルダ内の bin フォルダへのパスを、システムの環境変数 Path に追加してください。
3. コマンドプロンプトで ffmpeg -version と打ち、バージョンが表示されればOKです。
1. リポジトリの取得
git clone https://github.com/あなたのユーザー名/earcopyai.git
cd earcopyai

2. 仮想環境の作成と有効化
他のライブラリとの競合を防ぐため、専用の環境を作ります。
※必ず Python 3.8 を使用してください
# Windows (PowerShell) の場合
py -3.8 -m venv omni-env
.\omni-env\Scripts\activate

3. ライブラリのインストール
AIモデル（Omnizart）を正常に動かすため、特定のバージョンを指定してインストールします。この通りに実行してください。
# pip自体の更新
python -m pip install --upgrade pip

# メインのライブラリと、バージョン固定が必要なライブラリを一括インストール
pip install streamlit pandas pretty_midi demucs omnizart "numpy==1.19.5" "protobuf==3.20.0"

4. AIモデルのダウンロード
Omnizartの解析用モデルをダウンロードします。
omnizart download-checkpoints

※ 選択肢が表示された場合は、Piano, Music などを選択（Spaceキー）してダウンロードしてください。
5. アプリケーションの起動
以下のコマンドを実行すると、自動的にブラウザが立ち上がります。
streamlit run main.py


- 🎮 使用手順

2. 音源のアップロード
画面中央の 「MP3またはWAVをアップロード」 エリアに、解析したい音声ファイルをドラッグ＆ドロップ（またはクリックして選択）します。

アップロードが完了すると、オーディオプレイヤーが表示され、元の曲を確認できます。

3. 解析の実行
「解析スタート」 ボタンをクリックします。 AIによる処理が以下の3ステップで進行します（PCのスペックにより数分かかる場合があります）。

ギター分離: Demucsが楽曲からギターパートのみを抽出します。

AI解析: Omnizartが音程とリズムを解析し、MIDIデータへ変換します。

TAB描画: 解析データをギターの指板上にマッピングし、TAB譜を生成します。

4. 結果の確認と調整（重要）
解析が完了すると、画面にTAB譜が表示されます。サイドバー（画面左）のオプションを使って、自分の弾きやすいように表示を調整できます。

TAB譜を上下反転する:

TAB譜の上下（1弦と6弦）が逆に見える場合は、このチェックボックスをONにしてください。

カポタスト (Capo):

原曲がカポを使用している場合、スライダーでカポ位置（例: 2フレット）を指定すると、自動的にフレット数字が補正されます。

移調 (Transpose):

半音下げチューニング等の場合、ここを -1 などに設定することで正しい音程に補正できます。

5. データの保存
TAB譜: 表示されたテキストをコピーして、メモ帳などに保存できます。

MIDIファイル: 「MIDIファイルをダウンロード」 ボタンを押すと、解析されたMIDIデータを保存できます。これをDAWソフトやTuxGuitarなどのTAB譜ソフトで読み込むことも可能です。

Figjam https://www.figma.com/board/9iD7Hdd5MOvQ0kyz1ZGAbf/3%E5%B9%B4%E3%83%81%E3%83%BC%E3%83%A018-%E9%B7%B9%E5%B7%A3--%E4%B8%AD%E5%B6%8B-?fuid=1546757008178262515

画面構成図
https://www.figma.com/design/fiLr3yY6jErXzBs83SuTta/無題?m=auto&t=R3mbt1YmXYbXCV8K-6&fuid=1546757008178262515

システム構成図
![image](https://github.com/user-attachments/assets/19aa7c11-9816-4714-8845-3f113f5d3141)
